<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Inventory Manager</title>
    
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Tahoma&display=swap" rel="stylesheet">
    
    <style>
        /* --- GLOBAL RESET --- */
        * { box-sizing: border-box; outline: none; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            margin: 0; padding: 0;
            color: #333;
            background: #f4f7f6;
            min-height: 100vh;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            overflow-x: hidden;
        }

        /* --- 1. CINEMATIC INTRO (RESTORED MOVEMENT) --- */
        #intro-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.8s ease-in-out;
        }

        /* Container for the Icon to ensure centering */
        .logo-container {
            margin-bottom: 25px;
            perspective: 1000px;
        }

        /* The Moving Icon */
        .medical-cross {
            font-size: 80px; 
            color: #0056b3; /* BLUE */
            /* THIS IS THE MOVEMENT: Spin, Scale, and Fade In */
            animation: spinAndScale 1.8s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
            opacity: 0; 
        }

        .intro-title {
            font-size: 32px; font-weight: 900; 
            color: #0056b3; /* BLUE */
            text-transform: uppercase; letter-spacing: 2px;
            opacity: 0; 
            animation: slideUpFade 1s ease-out forwards 0.5s; /* Delays text appearance */
        }

        .intro-sub {
            font-size: 14px; color: #666; margin-top: 5px; letter-spacing: 1px;
            opacity: 0; 
            animation: slideUpFade 1s ease-out forwards 0.8s;
        }

        /* Keyframes for Intro Movement */
        @keyframes spinAndScale {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            60% { transform: scale(1.2) rotate(10deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        @keyframes slideUpFade {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* --- 2. BACKGROUND PARTICLES (MOVING) --- */
        .bg-animation {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none;
            background: linear-gradient(135deg, #eef2f3 0%, #8e9eab 100%);
        }
        .bg-icon {
            position: absolute; color: rgba(0, 86, 179, 0.08);
            animation: floatUp 25s linear infinite; bottom: -150px;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg) scale(0.8); opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(-110vh) rotate(360deg) scale(1.2); opacity: 0; }
        }

        /* --- 3. MAIN GLASS CARD --- */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            width: 95%; max-width: 1200px;
            padding: 40px; margin: 40px auto;
            position: relative;
            /* Entrance Animation */
            animation: fadeInCard 1s ease-out 2.8s backwards; 
        }
        @keyframes fadeInCard { 
            from { opacity: 0; transform: translateY(40px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* --- UPLOADER --- */
        .uploader-content { text-align: center; padding: 40px; }
        .upload-icon { font-size: 60px; color: #0056b3; margin-bottom: 20px; }
        .btn-upload { 
            background: linear-gradient(135deg, #0056b3, #004494);
            color: white; padding: 15px 50px; 
            border-radius: 50px; cursor: pointer; font-weight: 600; 
            display: inline-block; margin-top: 20px; 
            box-shadow: 0 10px 20px rgba(0, 86, 179, 0.2); 
            transition: all 0.3s ease;
        }
        .btn-upload:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(0, 86, 179, 0.3); }
        input[type="file"] { display: none; }

        /* --- HEADER & TOOLBAR --- */
        .report-header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px; }
        .logo-main { font-size: 28px; font-weight: 900; color: #0056b3; }
        .logo-sub { color: #dc3545; }
        .report-info { font-size: 13px; font-weight: 700; color: #444; margin-top: 5px; font-family: Tahoma, sans-serif; }

        .toolbar {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; gap: 20px; flex-wrap: wrap;
        }
        .search-box { position: relative; flex: 1; min-width: 300px; }
        .search-box input {
            width: 100%; padding: 12px 20px 12px 45px;
            border-radius: 30px; border: 1px solid #ddd;
            font-family: 'Poppins', sans-serif; font-size: 14px;
            background: #f9f9f9; transition: 0.3s;
        }
        .search-box input:focus { background: white; border-color: #0056b3; box-shadow: 0 0 10px rgba(0, 86, 179, 0.1); }
        .search-box i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #999; }

        .btn-group { display: flex; gap: 10px; }
        .btn-action { 
            border: none; padding: 10px 25px; cursor: pointer; 
            border-radius: 30px; font-weight: 600; font-size: 13px;
            display: flex; align-items: center; gap: 8px; transition: all 0.2s;
        }
        .btn-excel { background: #107c41; color: white; } 
        .btn-reset { background: white; color: #dc3545; border: 1px solid #dc3545; }
        .btn-action:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        /* --- DASHBOARD --- */
        .dashboard-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .stat-card {
            padding: 25px; border-radius: 15px; color: white;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .card-blue { background: linear-gradient(135deg, #0061f2, #60efff); }
        .card-red { background: linear-gradient(135deg, #eb3349, #f45c43); }
        .stat-info h3 { margin: 0; font-size: 12px; opacity: 0.9; text-transform: uppercase; }
        .stat-info p { margin: 5px 0 0; font-size: 28px; font-weight: 800; }
        .stat-icon { font-size: 40px; opacity: 0.3; }

        /* --- TABLE STYLES --- */
        .table-container {
            width: 100%; max-height: 500px; overflow: auto;
            border-radius: 10px; border: 1px solid #eee;
            background: white; margin-bottom: 30px;
        }
        table { width: 100%; border-collapse: collapse; font-family: 'Tahoma', sans-serif; min-width: 900px; }
        
        thead th {
            position: sticky; top: 0; z-index: 10;
            background-color: #FFFF00; /* Yellow */
            padding: 12px; font-size: 11px; font-weight: 800; color: #000;
            text-align: center; border-bottom: 2px solid #ccc;
            text-transform: uppercase;
        }
        td { 
            padding: 10px; font-size: 11px; color: #333; 
            border-bottom: 1px solid #f0f0f0; vertical-align: middle;
        }
        tr:hover { background-color: #f8f9fa; }

        .text-red { color: #dc3545; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .total-row { background-color: #eef2f3; font-weight: bold; font-size: 13px; }

        .btn-delete {
            background: none; border: none; color: #dc3545;
            cursor: pointer; font-size: 14px; opacity: 0.6; transition: 0.2s;
        }
        .btn-delete:hover { opacity: 1; transform: scale(1.2); }

        .section-title {
            font-size: 14px; font-weight: 800; color: #0056b3; 
            margin-bottom: 15px; display: inline-block; border-bottom: 2px solid #0056b3;
            font-family: Tahoma, sans-serif; letter-spacing: 1px;
        }

        .footer { text-align: center; margin-top: 30px; font-size: 11px; color: #888; font-weight: 600; }
        .hidden { display: none; }

    </style>
</head>
<body>

    <div id="intro-overlay">
        <div class="logo-container">
            <i class="fas fa-prescription medical-cross"></i>
        </div>
        <div class="intro-title">Completesolution <span style="color:#dc3545">Pharmacy</span></div>
        <div class="intro-sub">Intelligent Inventory System v3.0</div>
    </div>

    <div class="bg-animation" id="bgAnimation"></div>

    <div class="glass-card" id="mainCard">
        
        <div id="uploaderState" class="uploader-content">
            <i class="fas fa-file-medical-alt upload-icon"></i>
            <h2 style="margin: 0; color: #333; font-weight:800;">INVENTORY DASHBOARD</h2>
            <p style="color: #666; font-size: 14px; margin-top: 10px;">
                Upload Excel file to process.<br>
                MADE BY GELO
            </p>
            <label for="excelInput" class="btn-upload"><i class="fas fa-folder-open"></i> &nbsp; Select File</label>
            <input type="file" id="excelInput" accept=".xlsx, .xls">
        </div>

        <div id="reportState" class="hidden">
            
            <div class="report-header">
                <div class="logo-main">Completesolution <span class="logo-sub">Pharmacy</span></div>
                <div class="report-info">INVENTORY REPORT &bull; MULTICARE &bull; AS OF <span id="currentDate"></span></div>
            </div>

            <div class="toolbar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Type to filter (Branch, Code, Name)..." onkeyup="filterData()">
                </div>
                <div class="btn-group">
                    <button onclick="exportReportToExcel()" class="btn-action btn-excel"><i class="fas fa-file-excel"></i> Export Excel</button>
                    <button onclick="location.reload()" class="btn-action btn-reset"><i class="fas fa-redo"></i> New</button>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="stat-card card-blue">
                    <div class="stat-info"><h3>Total Good Stock</h3><p id="totalGoodStock">0</p></div>
                    <i class="fas fa-box-open stat-icon"></i>
                </div>
                <div class="stat-card card-red">
                    <div class="stat-info"><h3>Total Bad Stock</h3><p id="totalBadStock">0</p></div>
                    <i class="fas fa-trash-alt stat-icon"></i>
                </div>
            </div>

            <div class="table-container" id="mainTableArea"></div>
            
            <div class="section-title">NATIONAL SUMMARY (Auto-Calculated)</div>
            <div class="table-container" id="nationalTableArea"></div>
            
            <div class="footer">SYSTEM DEVELOPED BY GELO &copy; 2025</div>
        </div>
    </div>

    <script>
        let allData = []; 
        let badStockTotal = 0; 

        // --- INTRO SCRIPT ---
        window.addEventListener('load', () => {
            setTimeout(() => {
                const intro = document.getElementById('intro-overlay');
                intro.style.opacity = '0';
                setTimeout(() => { intro.style.display = 'none'; }, 800);
            }, 3000); // 3 Seconds animation
        });

        // Background Particles
        const container = document.getElementById('bgAnimation');
        const icons = ['fa-pills', 'fa-syringe', 'fa-first-aid', 'fa-tablets'];
        for(let i=0; i<20; i++) {
            let icon = document.createElement('i');
            icon.className = `fas ${icons[Math.floor(Math.random() * icons.length)]} bg-icon`;
            icon.style.left = Math.random() * 95 + '%';
            icon.style.animationDuration = (Math.random() * 20 + 15) + 's';
            icon.style.fontSize = (Math.random() * 30 + 20) + 'px';
            container.appendChild(icon);
        }

        // --- CORE LOGIC ---
        const today = new Date();
        const dateStr = today.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }).toUpperCase();
        document.getElementById('currentDate').innerText = dateStr;

        document.getElementById('excelInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, { type: 'array', cellDates: true });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                processInitialData(jsonData);
            };
            reader.readAsArrayBuffer(file);
        });

        function findValue(row, possibleKeys) {
            for (let key of possibleKeys) { if (row[key] !== undefined) return row[key]; }
            return ''; 
        }

        function processInitialData(rawData) {
            const excludedKeywords = ['EXPIRED', 'DAMAGE', 'DAMA', 'QUARANTINE', 'BAD ORDER', 'BO', 'REJECT', 'RET'];
            allData = [];
            badStockTotal = 0;

            rawData.forEach(row => {
                let branch = findValue(row, ['Location Code', 'Location', 'Branch']);
                let rawQty = findValue(row, ['On Hand Qty', 'Onhand Qty', 'Quantity', 'Qty']);
                let qty = parseFloat(String(rawQty).replace(/,/g, '')) || 0;

                let isBadStock = false;
                if (branch) {
                    const upperBranch = String(branch).toUpperCase();
                    if (excludedKeywords.some(keyword => upperBranch.includes(keyword))) { isBadStock = true; }
                }

                if (isBadStock) {
                    badStockTotal += qty;
                } else {
                    allData.push({
                        branch: branch,
                        code: findValue(row, ['Stock Code', 'Code', 'Item Code']),
                        name: findValue(row, ['Stock Name', 'Name', 'Item Description']),
                        qty: qty,
                        uom: findValue(row, ['UOM', 'Unit']),
                        lot: findValue(row, ['Stock Batch No', 'Lot No']),
                        rawExpiry: findValue(row, ['Expiry', 'Expiry Date'])
                    });
                }
            });

            allData.sort((a, b) => {
                const branchA = (a.branch || '').toString().toUpperCase();
                const branchB = (b.branch || '').toString().toUpperCase();
                if (branchA !== branchB) return branchA < branchB ? -1 : 1;
                return (a.code || '').toString().localeCompare((b.code || '').toString());
            });

            document.getElementById('uploaderState').style.display = 'none';
            document.getElementById('reportState').classList.remove('hidden');
            
            renderUI(allData);
        }

        function filterData() {
            const query = document.getElementById('searchInput').value.toUpperCase();
            const filteredData = allData.filter(item => {
                return (item.branch && item.branch.toString().toUpperCase().includes(query)) ||
                       (item.code && item.code.toString().toUpperCase().includes(query)) ||
                       (item.name && item.name.toString().toUpperCase().includes(query));
            });
            renderUI(filteredData);
        }

        window.deleteRow = function(index) {
            const itemToDelete = window.currentRenderedData[index];
            if(confirm(`Delete ${itemToDelete.name}?`)) {
                allData = allData.filter(i => i !== itemToDelete);
                filterData();
            }
        };

        function renderUI(dataToRender) {
            window.currentRenderedData = dataToRender; 
            let goodStockTotal = 0;
            let nationalSummary = {};

            let mainHTML = `
                <table><thead><tr>
                    <th style="width:5%;">DEL</th>
                    <th>BRANCH</th>
                    <th>CODE</th>
                    <th>NAME</th>
                    <th>ENDING</th>
                    <th>UOM</th>
                    <th>LOT NO</th>
                    <th>EXPIRY</th>
                    <th>REMARKS</th>
                </tr></thead><tbody>`;

            dataToRender.forEach((item, index) => {
                goodStockTotal += item.qty;

                if (item.code) {
                    if (!nationalSummary[item.code]) { 
                        nationalSummary[item.code] = { name: item.name, uom: item.uom, totalQty: 0 }; 
                    }
                    nationalSummary[item.code].totalQty += item.qty;
                }

                let expiryDisplay = '';
                let remarks = '';
                let rowClass = ''; 

                if (item.rawExpiry) {
                    let expDate = new Date(item.rawExpiry);
                    if (!isNaN(expDate)) {
                        expiryDisplay = expDate.toLocaleDateString('en-US');
                        let oneYearFromNow = new Date();
                        oneYearFromNow.setFullYear(today.getFullYear() + 1);
                        if (expDate < oneYearFromNow) { 
                            rowClass = 'text-red'; 
                            remarks = 'NEAR EXPIRY';
                        }
                    } else { expiryDisplay = item.rawExpiry; }
                }

                mainHTML += `
                    <tr>
                        <td class="text-center"><button class="btn-delete" onclick="deleteRow(${index})"><i class="fas fa-trash"></i></button></td>
                        <td>${item.branch}</td>
                        <td class="text-center">${item.code}</td>
                        <td style="font-weight:600;">${item.name}</td>
                        <td class="text-center">${item.qty}</td>
                        <td class="text-center">${item.uom}</td>
                        <td class="text-center">${item.lot}</td>
                        <td class="text-center">${expiryDisplay}</td>
                        <td class="text-center ${rowClass}">${remarks}</td>
                    </tr>`;
            });

            mainHTML += `<tr class="total-row"><td colspan="4" class="text-right">GRAND TOTAL:</td><td class="text-center">${goodStockTotal}</td><td colspan="4"></td></tr></tbody></table>`;
            
            document.getElementById('mainTableArea').innerHTML = mainHTML;
            document.getElementById('totalGoodStock').innerText = goodStockTotal.toLocaleString();
            document.getElementById('totalBadStock').innerText = badStockTotal.toLocaleString();

            let natList = Object.keys(nationalSummary).map(key => ({ code: key, ...nationalSummary[key] }));
            natList.sort((a, b) => (a.code || '').toString().localeCompare((b.code || '').toString()));

            let natHTML = `<table><thead><tr><th>CODE</th><th>NAME</th><th>ENDING</th><th>UOM</th></tr></thead><tbody>`;
            let natTotal = 0;

            natList.forEach(item => {
                natTotal += item.totalQty;
                natHTML += `<tr><td class="text-center">${item.code}</td><td>${item.name}</td><td class="text-center" style="font-weight:bold;">${item.totalQty}</td><td class="text-center">${item.uom}</td></tr>`;
            });
            natHTML += `<tr class="total-row"><td colspan="2" class="text-right">TOTAL:</td><td class="text-center">${natTotal}</td><td></td></tr></tbody></table>`;
            
            document.getElementById('nationalTableArea').innerHTML = natHTML;
        }

        // --- EXCEL EXPORT (FIXED HEADER & SPACING) ---
        function exportReportToExcel() {
            let data = window.currentRenderedData;
            
            let tableHTML = `
                <table border="1" style="font-family: Tahoma; font-size: 8pt; width: 100%;">
                    <thead>
                        <tr style="height:30px;">
                            <th style="background-color:#FFFF00; font-weight:700;">BRANCH</th>
                            <th style="background-color:#FFFF00; font-weight:700;">CODE</th>
                            <th style="background-color:#FFFF00; font-weight:700;">NAME</th>
                            <th style="background-color:#FFFF00; font-weight:700;">ENDING</th>
                            <th style="background-color:#FFFF00; font-weight:700;">UOM</th>
                            <th style="background-color:#FFFF00; font-weight:700;">LOT NO</th>
                            <th style="background-color:#FFFF00; font-weight:700;">EXPIRY</th>
                            <th style="background-color:#FFFF00; font-weight:700;">REMARKS</th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            let grandTotal = 0;
            let natSummary = {};

            data.forEach(item => {
                grandTotal += item.qty;
                if (item.code) {
                    if (!natSummary[item.code]) { natSummary[item.code] = { name: item.name, uom: item.uom, totalQty: 0 }; }
                    natSummary[item.code].totalQty += item.qty;
                }

                let expiryDisplay = '';
                let remarks = '';
                let style = '';

                if (item.rawExpiry) {
                    let expDate = new Date(item.rawExpiry);
                    if (!isNaN(expDate)) {
                        expiryDisplay = expDate.toLocaleDateString('en-US');
                        let oneYearFromNow = new Date();
                        oneYearFromNow.setFullYear(today.getFullYear() + 1);
                        if (expDate < oneYearFromNow) { 
                            style = 'color:#FF0000;'; 
                            remarks = 'NEAR EXPIRY';
                        }
                    } else { expiryDisplay = item.rawExpiry; }
                }

                tableHTML += `
                    <tr style="${style} height:20px;">
                        <td style="vertical-align:middle; padding:5px;">${item.branch}</td>
                        <td style="vertical-align:middle; text-align:center; mso-number-format:'\@';">${item.code}</td>
                        <td style="vertical-align:middle;">${item.name}</td>
                        <td style="vertical-align:middle; text-align:center;">${item.qty}</td>
                        <td style="vertical-align:middle; text-align:center;">${item.uom}</td>
                        <td style="vertical-align:middle; text-align:center; mso-number-format:'\@';">${item.lot}</td>
                        <td style="vertical-align:middle; text-align:center;">${expiryDisplay}</td>
                        <td style="vertical-align:middle; text-align:center;">${remarks}</td>
                    </tr>`;
            });

            tableHTML += `<tr style="background-color:#e0e0e0; font-weight:bold; height:25px;"><td colspan="3" style="text-align:right;">GRAND TOTAL:</td><td style="text-align:center;">${grandTotal}</td><td colspan="4"></td></tr></tbody></table>`;

            let natList = Object.keys(natSummary).map(key => ({ code: key, ...natSummary[key] }));
            natList.sort((a, b) => (a.code || '').toString().localeCompare((b.code || '').toString()));
            let natTotal = 0;

            let natHTML = `
                <br><br>
                <div style="font-weight:bold; font-family:Tahoma; font-size:10pt; color:#000;">NATIONAL SUMMARY (GOOD STOCK ONLY)</div>
                <table border="1" style="font-family: Tahoma; font-size: 8pt; width: 100%;">
                    <thead>
                        <tr style="height:30px;">
                            <th style="background-color:#FFFF00; font-weight:700;">CODE</th>
                            <th style="background-color:#FFFF00; font-weight:700;">NAME</th>
                            <th style="background-color:#FFFF00; font-weight:700;">ENDING</th>
                            <th style="background-color:#FFFF00; font-weight:700;">UOM</th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            natList.forEach(item => {
                natTotal += item.totalQty;
                natHTML += `<tr style="height:20px;"><td style="text-align:center; mso-number-format:'\@';">${item.code}</td><td>${item.name}</td><td style="text-align:center; font-weight:bold;">${item.totalQty}</td><td style="text-align:center;">${item.uom}</td></tr>`;
            });
            natHTML += `<tr style="background-color:#e0e0e0; font-weight:bold; height:25px;"><td colspan="2" style="text-align:right;">TOTAL:</td><td style="text-align:center;">${natTotal}</td><td></td></tr></tbody></table>`;

            var template = `
                <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
                <head>
                    <meta charset="UTF-8">
                    </head>
                <body>
                    <div style="text-align:center; margin-bottom:30px;">
                        <span style="font-family:Arial; font-size:24pt; font-weight:bold; color:#0056b3;">Completesolution</span>
                        <span style="font-family:Arial; font-size:24pt; font-weight:bold; color:#d32f2f;">Pharmacy</span>
                        <br><br> <div style="font-family:Arial; font-size:12pt; font-weight:bold; color:#000;">
                            INVENTORY REPORT &#8226; MULTICARE &#8226; AS OF ${dateStr}
                        </div>
                    </div>
                    <br>
                    ${tableHTML}
                    ${natHTML}
                </body>
                </html>`;

            var blob = new Blob([template], { type: 'application/vnd.ms-excel;charset=utf-8' });
            var link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `Inventory_Report_${new Date().toISOString().slice(0,10)}.xls`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
